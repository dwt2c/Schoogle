>>> import psycopg2
>>> import scrapy

from scrapy.spiders import Spider 
2 from scrapy.selector import Selector 
3 from scrapy import Request 
4 from schoogle_spider.items import O_Item 
5 from sys import getsizeof 
6 from datetime import datetime 
7 import time 


from shoogle_spider.items import item


/* Execute a command: this creates a new table
*/

class Shoogle_pipeline(object):
  def __init__(self):
    self.connection = psycopg2.connect(host='localhost', database='Shoogle', user='groupb')
    self.cursor = self.connection.cursor()
 
  def process_item(self, item, spider):
    # check item type to decide which table to insert
    try:
      if type(item) is USER1Item:
        self.cursor.execute("""INSERT INTO USER1 (UID, Username) VALUES(%s, %s)""", (item.get('UID'), item.get('Username')))
      elif type(item) is USER2Item:
        self.cursor.execute("""INSERT INTO USER2 (Username, Pword) VALUES(%s, %s)""", (item.get('Username'), item.get('Pword'), ))
	  elif type(item) is SEARCHESItem:
	    self.cursor.execute("""INSERT INTO SEARCHES (Choseen_results, UID, Searched_terms, Cut_down_terms, Time_stamp) VALUES(%s, %s, %s, %s, %s)""", (item.get('Chosen_results'), item.get('UID'), item.get('Searched_terms'), item.get('Cut_down_terms'), item.get('Time_Stamp') )))
      elif type(item) is CLIENTItem:
        self.cursor.execute("""INSERT INTO CLIENT (UID, Picture, IP) VALUES(%s, %s, %s)""", (item.get('UID'), item.get('Picture'), item.get('IP')))
	  elif type(item) is SEARCHABLEItem:
	    self.cursor.execute("""INSERT INTO SEARCHABLE (URL, PageRank, Security, Keywords) VALUES(%s, %s, %s, %s)""", (item.get('URL'), item.get('PageRank'), item.get('Security'), item.get('Keywords') )))

	  self.connection.commit()
      self.cursor.fetchall()
 
    except psycopg2.DatabaseError, e:
      print "Error: %s" % e
    return item


	 
	 
	 
	 
	 
	 
# Make the changes to the database persistent
>>> conn.commit()

# Close communication with the database
>>> cur.close()
>>> conn.close()
	 
	 return item
